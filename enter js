document.addEventListener('DOMContentLoaded', function () {
    const searchIcon = document.getElementById('search-icon');
    const popupSearch = document.getElementById('popup-search');
    const closeSearch = document.getElementById('close-search');
    const input = document.getElementById('live-search');
    const results = document.getElementById('search-results');

    if (!searchIcon || !popupSearch || !input || !results) return;

    searchIcon.addEventListener('click', () => popupSearch.style.display = 'flex');

    closeSearch.addEventListener('click', () => {
        popupSearch.style.display = 'none';
        results.innerHTML = '';
        input.value = '';
    });

    input.addEventListener('keyup', function (e) {
        const query = input.value;
        if (query.length < 3) {
            results.innerHTML = '';
            return;
        }

        // On Enter key (13), redirect to the first result
        if (e.key === 'Enter') {
            const firstLink = results.querySelector('a');
            if (firstLink) {
                window.location.href = firstLink.href;
            }
            return;
        }

        // Live search fetch
        fetch(live_search_data.ajax_url + '?action=live_search&q=' + encodeURIComponent(query))
            .then(res => res.text())
            .then(data => {
                results.innerHTML = data;
            });
    });
});
